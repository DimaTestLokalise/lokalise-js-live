var Lokalise={token:null,project:null,locale:null,onSave:null,lokaliseUrl:"https://lokalise.co",_enabled:!1,_keysBound:!1,_cookieAuthTokenName:"lokalise_auth_token",_cookieTokenName:"lokalise_token",_canHandle:!1,_handleElement:null,_elements:[],_contentOnFocus:"",init:function(e,o,t,a){if(void 0===e||void 0===o)return console.error("Lokalise cannot be init without required parameters."),null;Lokalise.project=e,Lokalise.locale=o,Lokalise._elements=document.getElementsByClassName(void 0===t?"lokalise":t),Lokalise.onSave=a,Lokalise._keyMaster.init(),Lokalise._keyMaster.assignKey("⌘+shift+e, ctrl+shift+e",function(e){if(Lokalise._enabled){Lokalise._enabled=!1;for(var o=0;o<Lokalise._elements.length;o++)Lokalise._setElementDisabled(Lokalise._elements[o])}else{var t=Lokalise._cookie.get(Lokalise._cookieTokenName);t&&null!=t&&"null"!=t?(Lokalise._enabled=!0,Lokalise.enable(t)):(Lokalise._cookie.listen(Lokalise._cookieAuthTokenName,function(e){var o=Lokalise._request("POST","/api/oauth","token="+encodeURIComponent(e)+"&id="+encodeURIComponent(Lokalise.project)+"&ratelimit=0");o.onreadystatechange=function(){if(o.readyState==XMLHttpRequest.DONE){try{var e=JSON.parse(o.responseText)}catch(t){console.error("Could not connect with the server:\n"+t.toString())}e&&"undefined"!=typeof e.api_token?(Lokalise._enabled=!0,Lokalise.enable(e.api_token)):e&&"undefined"!=typeof e.response.message?(alert(e.response.message),console.error(e)):alert("Ops. Something went wrong. Please try again later.")}}}),Lokalise._popup.open(Lokalise.lokaliseUrl+"/signin?oauth=1&referrer="+encodeURIComponent(window.location.href.split("#")[0]),"Lokalise"))}});var s=window.location.hash.substr(1).split("/");return"undefined"!=typeof s[0]&&"lokalise"===s[0]&&"undefined"!=typeof s[1]&&(console.log(s),Lokalise._cookie.set(Lokalise._cookieAuthTokenName,s[1]),window.close()),this},enable:function(e){if(!Lokalise._enabled)return null;if(void 0===e)return console.error("No api token given."),null;Lokalise.token=e,Lokalise._keysBound||Lokalise._bindKeys();for(var o=0;o<Lokalise._elements.length;o++)Lokalise._keysBound||Lokalise._addElementListeners(Lokalise._elements[o]),Lokalise._setElementEditable(Lokalise._elements[o]);return Lokalise._keysBound=!0,this},_bindKeys:function(){Lokalise._keyMaster.assignKey("⌘+i, ctrl+i",function(e){Lokalise._canHandle&&Lokalise._enabled&&(document.execCommand("italic",!1,"i"),e.preventDefault())}),Lokalise._keyMaster.assignKey("⌘+b, ctrl+b",function(e){Lokalise._canHandle&&Lokalise._enabled&&(document.execCommand("bold",!1,"b"),e.preventDefault())}),Lokalise._keyMaster.assignKey("⌘+u, ctrl+u",function(e){Lokalise._canHandle&&Lokalise._enabled&&(document.execCommand("underline",!1,"u"),e.preventDefault())}),Lokalise._keyMaster.assignKey("⌘+h, ctrl+h",function(e){if(Lokalise._canHandle&&Lokalise._enabled){var o=prompt("Enter HTML code:","");o&&document.execCommand("insertHTML",!1,o),e.preventDefault()}}),Lokalise._keyMaster.assignKey("⌘+/, ctrl+/",function(e){if(Lokalise._canHandle&&Lokalise._enabled){var o=prompt("Enter link URL:","http://");o&&document.execCommand("createlink",!1,o),e.preventDefault()}}),Lokalise._keyMaster.assignKey("⌘+s, ctrl+s",function(e){Lokalise._canHandle&&Lokalise._enabled&&(Lokalise._handleElement.blur(),e.preventDefault())})},_setElementEditable:function(e){e.setAttribute("contentEditable","true"),e.setAttribute("spellCheck","true")},_setElementDisabled:function(e){e.setAttribute("contentEditable","false")},_addElementListeners:function(e){e.addEventListener("focus",function(){Lokalise._enabled&&(Lokalise._contentOnFocus=this.innerHTML)}),e.addEventListener("blur",function(){Lokalise._enabled&&this.innerHTML!=Lokalise._contentOnFocus&&(Lokalise._save(this),Lokalise._contentOnFocus="")}),e.addEventListener("keydown",function(){Lokalise._enabled&&(Lokalise._canHandle=!0,Lokalise._handleElement=this)}),e.addEventListener("keyup",function(){Lokalise._enabled&&(Lokalise._canHandle=!1,Lokalise._handleElement=null)}),e.addEventListener("click",function(e){Lokalise._enabled&&(e.stopPropagation(),e.preventDefault())})},_request:function(e,o,t){var a=new XMLHttpRequest;if(!a)return console.error("Could not create XMLHttpRequest object"),!1;try{return a.open(e,Lokalise.lokaliseUrl+o),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send(t),a}catch(s){console.error("Could not connect with the server:\n"+s.toString())}},_save:function(e){var o=e.getAttribute("data-key"),t=e.innerHTML,a=[],s={},n=!1;s[Lokalise.locale]=t,a.push(s),(Lokalise.token||Lokalise.project)&&(n=Lokalise._request("POST","/api/string/set","api_token="+encodeURIComponent(Lokalise.token)+"&id="+encodeURIComponent(Lokalise.project)+"&ratelimit=0&data="+encodeURIComponent(JSON.stringify([{key:o,translations:a}]))),"function"==typeof Lokalise.onSave&&n&&(Lokalise.onSave(o,t,Lokalise.locale),Lokalise._updateSimilar(o,t))),n||console.error("Lokalise could not update translation string.")},_updateSimilar:function(e,o){for(var t,a=0;a<Lokalise._elements.length;a++)t=Lokalise._elements[a],t.getAttribute("data-key")===e&&(console.log("Found",t),t.innerHTML=o)},_popup:{open:function(e,o){var t=window.innerWidth,a=window.innerHeight,s=640,n=480,i=t>s?Math.floor((t-s)/2):0,l=a>n?Math.floor((a-n)/2):0,r="menubar=no,location=no,resizable=no,scrollbars=no,status=no,height="+n+",width="+s+",title=no,toolbar=no,top="+l+",left="+i,k=window.open(e,o,r);k.focus()}},_cookie:{listen:function(e,o){var t=window.setInterval(function(){var a=Lokalise._cookie.get(e);a&&"function"==typeof o&&null!=a&&"null"!=a&&(o(a),Lokalise._cookie.set(e,"null"),window.clearInterval(t))},1e3)},get:function(e){var o=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return o?decodeURIComponent(o[1]):void 0},set:function(e,o,t){t=t||{expires:86400,path:"/"};var a=t.expires;if("number"==typeof a&&a){var s=new Date;s.setTime(s.getTime()+1e3*a),a=t.expires=s}a&&a.toUTCString&&(t.expires=a.toUTCString()),o=encodeURIComponent(o);var n=e+"="+o;for(var i in t){n+="; "+i;var l=t[i];l!==!0&&(n+="="+l)}document.cookie=n}},_keyMaster:{k:null,modifierMap:{16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"},_handlers:{},_mods:{16:!1,18:!1,17:!1,91:!1},_scope:"all",_MODIFIERS:{"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},_MAP:{backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},key:{},previousKey:{},code:function(e){return Lokalise._keyMaster._MAP[e]||e.toUpperCase().charCodeAt(0)},_downKeys:[],init:function(){for(var e=1;20>e;e++)Lokalise._keyMaster._MAP["f"+e]=111+e;for(e in Lokalise._keyMaster._MODIFIERS)Lokalise._keyMaster.assignKey[e]=!1;Lokalise._keyMaster.addEvent(document,"keydown",function(e){Lokalise._keyMaster.dispatch(e)}),Lokalise._keyMaster.addEvent(document,"keyup",Lokalise._keyMaster.clearModifier),Lokalise._keyMaster.addEvent(window,"focus",Lokalise._keyMaster.resetModifiers),Lokalise._keyMaster.key.setScope=Lokalise._keyMaster.setScope,Lokalise._keyMaster.key.getScope=Lokalise._keyMaster.getScope,Lokalise._keyMaster.key.deleteScope=Lokalise._keyMaster.deleteScope,Lokalise._keyMaster.key.filter=Lokalise._keyMaster.filter,Lokalise._keyMaster.key.isPressed=Lokalise._keyMaster.isPressed,Lokalise._keyMaster.key.getPressedKeyCodes=Lokalise._keyMaster.getPressedKeyCodes,Lokalise._keyMaster.key.noConflict=Lokalise._keyMaster.noConflict,Lokalise._keyMaster.key.unbind=Lokalise._keyMaster.unbindKey,Lokalise._keyMaster.previousKey=Lokalise._keyMaster.key,"undefined"!=typeof module&&(module.exports=Lokalise._keyMaster.assignKey)},index:function(e,o){for(var t=e.length;t--;)if(e[t]===o)return t;return-1},compareArray:function(e,o){if(e.length!=o.length)return!1;for(var t=0;t<e.length;t++)if(e[t]!==o[t])return!1;return!0},updateModifierKey:function(e){for(var o in Lokalise._keyMaster._mods)Lokalise._keyMaster._mods[o]=e[Lokalise._keyMaster.modifierMap[o]]},dispatch:function(e){var o,t,a,s,n,i;if(o=e.keyCode,-1==Lokalise._keyMaster.index(Lokalise._keyMaster._downKeys,o)&&Lokalise._keyMaster._downKeys.push(o),(93==o||224==o)&&(o=91),o in Lokalise._keyMaster._mods){Lokalise._keyMaster._mods[o]=!0;for(a in Lokalise._keyMaster._MODIFIERS)Lokalise._keyMaster._MODIFIERS[a]==o&&(Lokalise._keyMaster.assignKey[a]=!0)}else if(Lokalise._keyMaster.updateModifierKey(e),o in Lokalise._keyMaster._handlers)for(i=Lokalise._keyMaster.getScope(),s=0;s<Lokalise._keyMaster._handlers[o].length;s++)if(t=Lokalise._keyMaster._handlers[o][s],t.scope==i||"all"==t.scope){n=t.mods.length>0;for(a in Lokalise._keyMaster._mods)(!Lokalise._keyMaster._mods[a]&&Lokalise._keyMaster.index(t.mods,+a)>-1||Lokalise._keyMaster._mods[a]&&-1==Lokalise._keyMaster.index(t.mods,+a))&&(n=!1);(0!=t.mods.length||Lokalise._keyMaster._mods[16]||Lokalise._keyMaster._mods[18]||Lokalise._keyMaster._mods[17]||Lokalise._keyMaster._mods[91])&&!n||t.method(e,t)===!1&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0))}},clearModifier:function(e){var o,t=e.keyCode,a=Lokalise._keyMaster.index(Lokalise._keyMaster._downKeys,t);if(a>=0&&Lokalise._keyMaster._downKeys.splice(a,1),(93==t||224==t)&&(t=91),t in Lokalise._keyMaster._mods){Lokalise._keyMaster._mods[t]=!1;for(o in Lokalise._keyMaster._MODIFIERS)Lokalise._keyMaster._MODIFIERS[o]==t&&(Lokalise._keyMaster.assignKey[o]=!1)}},resetModifiers:function(){var e;for(e in Lokalise._keyMaster._mods)Lokalise._keyMaster._mods[e]=!1;for(e in Lokalise._keyMaster._MODIFIERS)Lokalise._keyMaster.assignKey[e]=!1},assignKey:function(e,o,t){var a,s;a=Lokalise._keyMaster.getKeys(e),void 0===t&&(t=o,o="all");for(var n=0;n<a.length;n++)s=[],e=a[n].split("+"),e.length>1&&(s=Lokalise._keyMaster.getMods(e),e=[e[e.length-1]]),e=e[0],e=Lokalise._keyMaster.code(e),e in Lokalise._keyMaster._handlers||(Lokalise._keyMaster._handlers[e]=[]),Lokalise._keyMaster._handlers[e].push({shortcut:a[n],scope:o,method:t,key:a[n],mods:s})},unbindKey:function(e,o){var t,a,s,n,i,l=[];for(t=Lokalise._keyMaster.getKeys(e),n=0;n<t.length;n++){if(a=t[n].split("+"),a.length>1&&(l=Lokalise._keyMaster.getMods(a)),e=a[a.length-1],e=Lokalise._keyMaster.code(e),void 0===o&&(o=Lokalise._keyMaster.getScope()),!Lokalise._keyMaster._handlers[e])return;for(s=0;s<Lokalise._keyMaster._handlers[e].length;s++)i=Lokalise._keyMaster._handlers[e][s],i.scope===o&&Lokalise._keyMaster.compareArray(i.mods,l)&&(Lokalise._keyMaster._handlers[e][s]={})}},isPressed:function(e){return"string"==typeof e&&(e=Lokalise._keyMaster.code(e)),-1!=Lokalise._keyMaster.index(Lokalise._keyMaster._downKeys,e)},getPressedKeyCodes:function(){return Lokalise._keyMaster._downKeys.slice(0)},filter:function(e){var o=(e.target||e.srcElement).tagName;return!("INPUT"==o||"SELECT"==o||"TEXTAREA"==o)},setScope:function(e){Lokalise._keyMaster._scope=e||"all"},getScope:function(){return Lokalise._keyMaster._scope||"all"},deleteScope:function(e){var o,t,a;for(o in Lokalise._keyMaster._handlers)for(t=Lokalise._keyMaster._handlers[o],a=0;a<t.length;)t[a].scope===e?t.splice(a,1):a++},getKeys:function(e){var o;return e=e.replace(/\s/g,""),o=e.split(","),""==o[o.length-1]&&(o[o.length-2]+=","),o},getMods:function(e){for(var o=e.slice(0,e.length-1),t=0;t<o.length;t++)o[t]=Lokalise._keyMaster._MODIFIERS[o[t]];return o},addEvent:function(e,o,t){e.addEventListener?e.addEventListener(o,t,!1):e.attachEvent&&e.attachEvent("on"+o,function(){t(window.event)})},noConflict:function(){var e=Lokalise._keyMaster.key;return Lokalise._keyMaster.key=Lokalise._keyMaster.previousKey,e}}};